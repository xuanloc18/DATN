<!DOCTYPE html>
<html class="no-js" lang="zxx">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="meta description">
    <title>Ananas - Shoes Store</title>
    <!--=== Favicon ===-->
    <link rel="shortcut icon" href="assets/img/favicon.ico" type="image/x-icon" />
    <!--=== All Plugins CSS ===-->
    <link href="assets/css/plugins.css" rel="stylesheet">
    <!--=== All Vendor CSS ===-->
    <link href="assets/css/vendor.css" rel="stylesheet">
    <!--=== Main Style CSS ===-->
    <link href="assets/css/style.css" rel="stylesheet">
    <!-- Modernizer JS -->
    <script src="assets/js/modernizr-2.8.3.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


    <!--[if lt IE 9]>
<script src="//oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="//oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>

<body>

    <!-- Start Header Area -->
    <header class="header-area">
        <!-- main header start -->
        <div class="main-header d-none d-lg-block">


            <!-- header middle area start -->
            <div class="header-main-area sticky">
                <div class="container">
                    <div class="row align-items-center position-relative">
                        <!-- start logo area -->
                        <div class="col-lg-2">
                            <div class="logo">
                                <a href="index-2.html">
                                    <img src="assets/img/logo/logo.png" alt="">
                                </a>
                            </div>
                        </div>
                        <!-- start logo area -->

                        <!-- main menu area start -->
                        <div class="col-lg-8 position-static">
                            <div class="main-menu-area">
                                <div class="main-menu">
                                    <!-- main menu navbar start -->
                                    <nav class="desktop-menu">
                                        <ul>
                                            <li><a href="index-2.html">Trang chủ </a></li>
                                            <li class="active"><a href="shop.html">Cửa hàng</a></li>
                                            <li><a href="contact-us.html">Liên hệ</a></li>
                                        </ul>
                                        <ul class="mt-1 mb-5">
                                            <li>
                                                <input type="text" id="searchInput" style="width: 500px;" placeholder="Nhập sản phẩm cần tìm kiếm...">
                                                <button id="searchBtn"><i class="ion-ios-search-strong"></i> Tìm kiếm</button>
                                            </li>
                                        </ul>
                                        
                                        <div id="searchResults" class="search-results" style="display: none; width: 500px; border: 1px solid #ccc; padding: 10px; max-height: 300px; overflow-y: auto; margin-top: 10px;"></div>                                        
                                    
                                    </nav>
                                    <!-- main menu navbar end -->
                                </div>
                            </div>
                        </div>
                        <!-- main menu area end -->

                        <!-- mini cart area start -->
                        <div class="col-lg-2">
                            <div class="header-configure-wrapper">
                                <div class="header-configure-area">
                                    <ul class="nav justify-content-end">
                                        
                                        <li class="user-hover">
                                            <a href="#">
                                                <i class="ion-ios-gear-outline"></i>
                                            </a>
                                            <ul class="dropdown-list">
                                                <li><a href="login.html">Đăng nhập</a></li>
                                                <li><a href="register.html">Đăng ký</a></li>
                                                <li><a href="my-account.html">Tài khoản</a></li>
                                            </ul>
                                        </li>
                                        <li>
                                            <a href="#" class="minicart-btn">
                                                <i class="ion-bag"></i>
                                                <div class="notification" id="cart-quantity">0</div>
                                            </a>
                                        </li>
                                        <!-- Thêm ảnh user -->
                                        <li class="user-thumbnail">
                                            <a href="my-account.html">
                                                <img src="assets/img/about/avatar.jpg" alt="User" class="user-image">
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!-- mini cart area end -->
                    </div>
                </div>
            </div>
            <!-- header middle area end -->
        </div>
        <!-- main header start -->


    </header>
    <!-- end Header Area -->

    <!-- main wrapper start -->
    <main>

        <!-- product details wrapper start -->
        <div class="product-details-wrapper mt-5 mb-5">
            <div class="container custom-container">
                <div class="row">
                    <div class="col-12">
                        <!-- product details inner end -->
                        <div class="product-details-inner">
                            <div class="row">
                                <div class="col-lg-5">
                                    <div class="product-large-slider">
                                        <img id="mainImage" src="" alt="" class="img-fluid zoomable" />
                                    </div>
                                    <!-- Các hình ảnh thumbnail sẽ được thêm vào động -->
                                    <div id="thumbnails" class="product-thumbnails mt-3 d-flex">
                                        <img id="thumb1" src="" alt="Thumbnail 1" class="img-thumbnail me-2 thumbnail"
                                            style="cursor: pointer;">
                                        <img id="thumb2" src="" alt="Thumbnail 2" class="img-thumbnail me-2 thumbnail"
                                            style="cursor: pointer;">
                                        <img id="thumb3" src="" alt="Thumbnail 3" class="img-thumbnail me-2 thumbnail"
                                            style="cursor: pointer;">
                                        <img id="thumb4" src="" alt="Thumbnail 4" class="img-thumbnail me-2 thumbnail"
                                            style="cursor: pointer;">
                                    </div>
                                </div>
                                <div class="col-lg-7">
                                    <div class="product-details-des">
                                        <h3 id="productName" class="pro-det-title"></h3>
                                        <div class="pro-review">
                                            <p>Số lượt đánh giá: <span style="margin-bottom: 10px;" id="reviews"></span>
                                            </p>
                                        </div>
                                        <div class="price-box">
                                            <span id="currentPrice" class="regular-price"></span>
                                            <span class="old-price"><del id="oldPrice"></del></span>
                                        </div>
                                        <p id="description"></p>
                                        <div class="availability">
                                            <strong>Tồn kho:</strong> <span id="availability" class="text-success"></span>
                                        </div>

                                        <!-- Chọn màu -->
                                        <div class="color-selection">
                                            <label><strong>Màu sắc:</strong></label>
                                            <div class="d-flex mt-2">
                                                <div class="color-box me-2" style="background-color: white;"
                                                    data-color="White">
                                                </div>
                                                <div class="color-box me-2" style="background-color: black;"
                                                    data-color="Black">
                                                </div>
                                                <div class="color-box me-2" style="background-color: blue;"
                                                    data-color="Blue">
                                                </div>
                                                <div class="color-box me-2" style="background-color: red;" data-color="Red">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Chọn size -->
                                        <div class="size-selection mt-3">
                                            <label><strong>Kích cỡ:</strong></label>
                                            <div class="d-flex mt-2">
                                                <div class="size-box me-2" data-size="37">37</div>
                                                <div class="size-box me-2" data-size="38">38</div>
                                                <div class="size-box me-2" data-size="39">39</div>
                                                <div class="size-box me-2" data-size="40">40</div>
                                                <div class="size-box me-2" data-size="41">41</div>
                                                <div class="size-box me-2" data-size="42">42</div>
                                                <div class="size-box me-2" data-size="43">43</div>
                                                <div class="size-box me-2" data-size="44">44</div>
                                            </div>
                                        </div>
                                        <!-- Số lượng và nút thêm giỏ hàng -->
                                        <div style="margin-bottom: 10px;" class="quantity mt-3">
                                            <label for="quantityInput">Số lượng:</label>
                                            <input class="quantityInput" id="quantityInput" type="number" value="0" min="0" max="0"
                                                class="form-control w-25 d-inline">
                                            <button id="addToCart2" class="btn btn-dark ms-2">Thêm giỏ hàng</button>
                                        </div>
                                        <div class="share-icon">
                                            <h5 class="cat-title">Chia sẻ:</h5>
                                            <a href="#"><i class="fa fa-facebook"></i></a>
                                            <a href="#"><i class="fa fa-twitter"></i></a>
                                            <a href="#"><i class="fa fa-pinterest"></i></a>
                                            <a href="#"><i class="fa fa-google-plus"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- product details inner end -->

                        <!-- product details reviews start -->
                        <div class="product-details-reviews mt-5 mb-5">
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="product-review-info">
                                        <ul class="nav review-tab" role="tablist">
                                            <li>
                                                <button class="active" id="tab_one_btn" type="button"
                                                    data-bs-toggle="tab" data-bs-target="#tab_one" role="tab"
                                                    aria-controls="tab_one" aria-selected="true">Mô tả</button>
                                            </li>
                                            <li>
                                                <button id="tab_two_btn" type="button" data-bs-toggle="tab"
                                                    data-bs-target="#tab_two" role="tab" aria-controls="tab_two"
                                                    aria-selected="false">Thông tin</button>
                                            </li>
                                            <li>
                                                <button id="tab_three_btn" type="button" data-bs-toggle="tab"
                                                    data-bs-target="#tab_three" role="tab" aria-controls="tab_three"
                                                    aria-selected="false">Đánh giá</button>
                                            </li>
                                        </ul>
                                        <div class="tab-content reviews-tab">
                                            <div class="tab-pane fade show active" id="tab_one" role="tabpanel"
                                                aria-labelledby="tab_one_btn">
                                                <div class="tab-one">
                                                    <p></p>
                                                    <div class="review-description">
                                                        <div class="tab-thumb">
                                                            <img src="assets/img/about/services.jpg" alt="">
                                                        </div>
                                                        <div class="tab-des">
                                                            <p id="des"></p>
                                                        </div>
                                                    </div>
                                                    <p></p>
                                                </div>
                                            </div>
                                            <div class="tab-pane fade" id="tab_two" role="tabpanel"
                                                aria-labelledby="tab_two_btn">
                                                <table class="table table-bordered">
                                                    <thead>
                                                        <tr>
                                                            <th>Kích cỡ</th>
                                                            <th>Màu sắc</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="product-variants">
                                                        <!-- Biến thể sẽ được thêm vào đây -->
                                                    </tbody>
                                                </table>
                                            </div>
                                            <div class="tab-pane fade" id="tab_three" role="tabpanel"
                                                aria-labelledby="tab_three_btn">
                                                <form action="#" class="review-form" id="reviewForm">
                                                    <h5 id="review-count"></h5>
                                                    <div id="review-list">
                                                        <!-- Reviews sẽ được hiển thị ở đây -->
                                                    </div>
                                                    <div class="form-group row mb-3">
                                                        <div class="col">
                                                            <label class="col-form-label"><span
                                                                    class="text-danger">*</span>Bình luận</label>
                                                            <textarea class="form-control" id="reviewContent"
                                                                required></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="form-group row mb-3">
                                                        <div class="col">
                                                            <label class="col-form-label"><span
                                                                    class="text-danger">*</span> Đánh giá sản
                                                                phẩm</label>
                                                            &nbsp;&nbsp;&nbsp; Tệ&nbsp;
                                                            <input type="radio" value="1" name="rating" id="rating1">
                                                            &nbsp;
                                                            <input type="radio" value="2" name="rating">
                                                            &nbsp;
                                                            <input type="radio" value="3" name="rating">
                                                            &nbsp;
                                                            <input type="radio" value="4" name="rating">
                                                            &nbsp;
                                                            <input type="radio" value="5" name="rating" checked>
                                                            &nbsp;Tốt
                                                        </div>
                                                    </div>
                                                    <div class="buttons">
                                                        <button class="btn" type="button"
                                                            id="submitReview">Đăng</button>
                                                    </div>
                                                </form>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- product details reviews end -->

                        <!-- featured product area start -->
                        <section class="Related-product">
                            <div class="container">
                                <div class="row">
                                    <div class="col-12">
                                        <div class="section-title text-center">
                                            <h2 class="title">Có thể bạn quan tâm</h2>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12">
                                        <div class="product-carousel mbn-50 slick-row-15 slick-arrow-style slick-slider"
                                            id="lastest-product-list">

                                            <!-- product single item start -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <!-- featured product area end -->
                    </div>
                </div>
            </div>
        </div>
        <!-- product details wrapper end -->
    </main>
    <!-- main wrapper end -->

    <!-- modal quickview -->
    <div class="modal fade" id="quick_view" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                        style="margin-top: 5px;"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <!-- Image Section -->
                        <div class="col-md-6">
                            <div class="product-large-slider" style="position: relative; overflow: hidden;">
                                <img id="mainImage-1" src="" alt="Product Image" class="img-fluid zoomable">
                            </div>
                            <div class="product-thumbnails mt-3 d-flex">
                                <!-- Thumbnail Images -->
                                <img style="width: 90px; height: 80px;" id="thumb1-1" src="" alt="Thumbnail 1"
                                    class="img-thumbnail me-2 thumbnail-1" style="cursor: pointer;">
                                <img style="width: 90px; height: 80px;" id="thumb2-1" src="" alt="Thumbnail 2"
                                    class="img-thumbnail me-2 thumbnail-1" style="cursor: pointer;">
                                <img style="width: 90px; height: 80px;" id="thumb3-1" src="" alt="Thumbnail 3"
                                    class="img-thumbnail me-2 thumbnail-1" style="cursor: pointer;">
                                <img style="width: 90px; height: 80px;" id="thumb4-1" src="" alt="Thumbnail 4"
                                    class="img-thumbnail me-2 thumbnail-1" style="cursor: pointer;">
                            </div>
                        </div>
                        <!-- Details Section -->
                        <div class="col-md-6">
                            <div class="product-details">
                                <h5 style="margin-bottom: 10px;" class="modal-title" id="productName-1"> 
                                </h5>
                                <div style="margin-bottom: 10px;" class="pro-review">
                                    <p>Số lượt đánh giá: <span style="margin-bottom: 10px;" id="reviews-1"></span></p>
                                </div>
                                <div style="margin-bottom: 10px;" class="price-box">
                                    <span id="currentPrice-1" class="price-regular"></span>
                                    <span id="oldPrice-1" class="price-old text-muted"><del></del></span>
                                </div>
                                <p style="margin-bottom: 10px;" id="description-1"></p>
                                <div class="availability-1">
                                    <strong>Tồn kho:</strong> <span id="availability-1" class="text-success"></span>
                                </div>
                                <div id="qvId" style="display: none;"></div>

                                <!-- Chọn màu -->
                                <div class="color-selection mt-3">
                                    <label><strong>Màu sắc:</strong></label>
                                    <div class="d-flex mt-2">
                                        <div class="color-box me-2" style="background-color: white;" data-color="White">
                                        </div>
                                        <div class="color-box me-2" style="background-color: black;" data-color="Black">
                                        </div>
                                        <div class="color-box me-2" style="background-color: blue;" data-color="Blue">
                                        </div>
                                        <div class="color-box me-2" style="background-color: red;" data-color="Red"></div>
                                    </div>
                                </div>

                                <!-- Chọn size -->
                                <div class="size-selection mt-3">
                                    <label><strong>Kích cỡ:</strong></label>
                                    <div class="d-flex mt-2">
                                        <div class="size-box me-2" data-size="37">37</div>
                                        <div class="size-box me-2" data-size="38">38</div>
                                        <div class="size-box me-2" data-size="39">39</div>
                                        <div class="size-box me-2" data-size="40">40</div>
                                        <div class="size-box me-2" data-size="41">41</div>
                                        <div class="size-box me-2" data-size="42">42</div>
                                        <div class="size-box me-2" data-size="43">43</div>
                                        <div class="size-box me-2" data-size="44">44</div>
                                    </div>
                                </div>

                                <!-- Số lượng và nút thêm giỏ hàng -->
                                <div style="margin-bottom: 10px;" class="quantity mt-3">
                                    <label for="quantityInput">Số lượng:</label>
                                    <input id="quantityInput-1" type="number" value="0" min="0" max="0"
                                        class="form-control w-25 d-inline">
                                    <button id="addToCart" class="btn btn-dark ms-2">Thêm giỏ hàng</button>
                                </div>

                                <div style="margin-bottom: 10px;" class="social-share mt-3">
                                    <strong>Chia sẻ:</strong>
                                    <a href="#" class="ms-2"><i class="ion-social-facebook"></i></a>
                                    <a href="#" class="ms-2"><i class="ion-social-twitter"></i></a>
                                    <a href="#" class="ms-2"><i class="ion-social-pinterest"></i></a>
                                    <a href="#" class="ms-2"><i class="ion-social-googleplus"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end modal quickview-->

    <!-- Start Footer Area Wrapper -->
    <footer class="footer-wrapper">
        <!-- footer main area start -->
        <div class="footer-widget-area mt-5">
            <div class="container">
                <div class="row mtn-4">
                    <!-- footer widget item start -->
                    <div class="col-xl-5 col-lg-3 col-md-6">
                        <div class="widget-item mt-4">
                            <h5 class="widget-title">Thông tin liên hệ</h5>
                            <div class="widget-body">
                                <ul class="location-wrap">
                                    <li><i class="ion-ios-location-outline"></i>Minh Khai Ward, Bac Tu Liem District,
                                        Hanoi City.</li>
                                    <li><i class="ion-ios-email-outline"></i>Mail: <a
                                            href="mailto:yourmail@gmail.com">ananas@gmail.com</a></li>
                                    <li><i class="ion-ios-telephone-outline"></i>Phone: <a
                                            href="%2b0025425456554.html">+0123456789</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <!-- footer widget item end -->
                    <div class="col-xl-3 col-lg-3 col-md-4"></div>
                    <!-- footer widget item end -->
                    <div class="col-xl-3 col-lg-3 col-md-4">
                        <iframe
                            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3723.4737884515107!2d105.73253187608918!3d21.053730980601838!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31345457e292d5bf%3A0x20ac91c94d74439a!2zVHLGsOG7nW5nIMSQ4bqhaSBo4buNYyBDw7RuZyBuZ2hp4buHcCBIw6AgTuG7mWk!5e0!3m2!1svi!2s!4v1733187950170!5m2!1svi!2s"
                            width="400" height="200" style="border:0;" allowfullscreen="" loading="lazy"
                            referrerpolicy="no-referrer-when-downgrade"></iframe>
                    </div>
                    <!-- footer widget item end -->
                </div>
            </div>
        </div>
        <!-- footer main area end -->


    </footer>
    <!-- End Footer Area Wrapper -->

    
    <!-- offcanvas mini cart start -->
    <div class="offcanvas-minicart-wrapper">
        <div class="minicart-inner">
            <div class="offcanvas-overlay"></div>
            <div class="minicart-inner-content">
                <div class="minicart-close">
                    <i class="ion-android-close"></i>
                </div>
                <h3 style="text-align: center; margin-bottom: 30px;">Giỏ hàng của bạn</h3>
                <div class="minicart-content-box">
                    <div class="minicart-item-wrapper">
                        <ul>

                        </ul>
                    </div>

                    <div class="minicart-pricing-box">
                        <ul>

                        </ul>
                    </div>

                    <div class="minicart-button">
                        <a href="cart.html"><i class="fa fa-shopping-cart"></i>Giỏ hàng</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- offcanvas mini cart end -->
    <!-- Scroll to top start -->
    <div class="scroll-top not-visible">
        <i class="fa fa-angle-up"></i>
    </div>
    <!-- Scroll to Top End -->

    <!--=======================Javascript============================-->
    <!--=== All Vendor Js ===-->
    <script src="assets/js/vendor.js"></script>
    <!--=== All Plugins Js ===-->
    <script src="assets/js/plugins.js"></script>
    <!--=== Active Js ===-->
    <script src="assets/js/active.js"></script>
</body>


</html>


<script type="text/javascript">
    const token = localStorage.getItem('token'); // Lấy token đăng nhập
    const userId = localStorage.getItem('userId');

    // Bắt đầu xử lý mini card
    function renderMiniCart(cartItems, summary) {
        const cartWrapper = document.querySelector(".minicart-item-wrapper ul");
        const pricingBox = document.querySelector(".minicart-pricing-box ul");

        // Làm rỗng nội dung cũ
        pricingBox.innerHTML = "";
        cartWrapper.innerHTML = "";


        // Render từng sản phẩm
        cartItems.forEach(item => {
            const product = item.product;
            const quantity = item.quantity;
            const cartItemHTML = `
            <li class="minicart-item">
                <div class="minicart-thumb">
                    <a href="product-details.html?id=${product.productId}">
                        <img src="http://localhost:8080/images/product/${product.images[0]}" alt="${product.productName}">
                    </a>
                </div>
                <div class="minicart-content">
                    <h3 class="product-name" style="padding: 0px;">
                        <a href="product-details.html?id=${product.productId}">${product.productName}</a>
                    </h3>
                    <p>
                        <span class="cart-quantity">${quantity} <strong>&times;</strong></span>
                        <span class="cart-price">${(product.price).toLocaleString()} VNĐ</span>
                    </p>
                    <p>
                        <span class="product-name">Màu sắc: ${product.color}</span><br>
                        <span class="product-name">Kích thước: ${product.size}</span>
                    </p>
                </div>
                <button class="minicart-remove" data-variant-id="${product.variantId}">
                    <i class="ion-android-close"></i>
                </button>
            </li>
        `;
            cartWrapper.innerHTML += cartItemHTML;
        });
        document.getElementById('cart-quantity').innerText = summary.totalQuantity;
        // Render tổng giá trị
        pricingBox.innerHTML += `
        <li><span>Tổng giá trước thuế</span><span><strong>${summary.totalPrice.toLocaleString()} VNĐ</strong></span></li>
        <li><span>VAT (10%)</span><span><strong>${(summary.totalPrice * 0.1).toLocaleString()} VNĐ</strong></span></li>
        <li class="total"><span>Tổng giá sau thuế</span><span><strong>${(summary.totalPrice * 1.1).toLocaleString()} VNĐ</strong></span></li>
    `;
    }

    // Hàm lấy dữ liệu sản phẩm trong giỏ hàng
    async function fetchCartItems(userId) {
        try {
            const response = await fetch(`http://localhost:8080/cart?userId=${userId}`, {
                method: "GET",
                headers: {
                    "Authorization": token,
                    "Content-Type": "application/json"
                }
            });
            const data = await response.json();
            if (data.code === 200) {
                return data.result;
            } else {
                throw new Error(data.message || "Failed to fetch cart items.");
            }
        } catch (error) {
            console.error("Error fetching cart items:", error);
            return [];
        }
    }

    // Hàm lấy dữ liệu tổng hợp giỏ hàng (số lượng và giá trị)
    async function fetchCartSummary(userId) {
        try {
            const [quantityRes, priceRes] = await Promise.all([
                fetch(`http://localhost:8080/cart/quantity?userId=${userId}`, {
                    method: "GET",
                    headers: {
                        "Authorization": token,
                        "Content-Type": "application/json"
                    }
                }).then(res => res.json()),
                fetch(`http://localhost:8080/cart/sumprice?userId=${userId}`, {
                    method: "GET",
                    headers: {
                        "Authorization": token,
                        "Content-Type": "application/json"
                    }
                }).then(res => res.json())
            ]);
            return {
                totalQuantity: quantityRes.result,
                totalPrice: priceRes.result
            };
        } catch (error) {
            console.error("Error fetching cart summary:", error);
            return { totalQuantity: 0, totalPrice: 0 };
        }
    }

    // Khi nhấn vào nút giỏ hàng, gọi API và hiển thị giỏ hàng mini (nếu chưa gọi trước đó)
    document.querySelector(".minicart-btn").addEventListener("click", async (event) => {
        event.preventDefault();  // Ngừng hành động mặc định của liên kết
        const minicartWrapper = document.querySelector(".offcanvas-minicart-wrapper");  // Giỏ hàng mini
        const cartItems = await fetchCartItems(userId);
        if (cartItems.length === 0) {
            const pricingBox = document.querySelector(".minicart-pricing-box ul");
            pricingBox.innerHTML = '<div style="text-align: center; margin: 20px 0;"> <i class="ion-bag" style="font-size: 50px; color: #ccc;"></i> <p style="font-size: 16px; color: #666; margin-top: 10px;"> Giỏ hàng của bạn đang trống </p> </div>';

        } else {
            const cartSummary = await fetchCartSummary(userId);
            renderMiniCart(cartItems, cartSummary);
        }
    });

    // Xử lý khi nhấn nút xóa sản phẩm khỏi giỏ hàng
    document.addEventListener("click", async (event) => {
        if (event.target.classList.contains("minicart-remove")) {
            const productElement = event.target.closest(".minicart-item");
            const variantId = event.target.getAttribute("data-variant-id");

            // Hiển thị hộp thoại xác nhận trước khi xóa
            const isConfirmed = confirm("Bạn có chắc chắn muốn xóa sản phẩm này khỏi giỏ hàng?");
            if (isConfirmed) {
                try {
                    // Gửi yêu cầu xóa sản phẩm
                    const response = await fetch(`http://localhost:8080/cart/variant/${variantId}?userId=${userId}`, {
                        method: "DELETE",
                        headers: {
                            "Authorization": token,
                            "Content-Type": "application/json"
                        }
                    });

                    if (response.ok) {
                        // Xóa sản phẩm khỏi giao diện
                        productElement.remove();
                        reloadMiniCart(userId);
                    } else {
                        throw new Error("Failed to remove item");
                    }
                } catch (error) {
                    console.error("Error removing cart item:", error);
                }
            }
        }
    });

    // Hàm reload lại giỏ hàng mini sau khi xóa sản phẩm
    async function reloadMiniCart(userId) {
        try {
            const cartItems = await fetchCartItems(userId);
            if (cartItems.length === 0) {
                const pricingBox = document.querySelector(".minicart-pricing-box ul");
                pricingBox.innerHTML = '<div style="text-align: center; margin: 20px 0;"> <i class="ion-bag" style="font-size: 50px; color: #ccc;"></i> <p style="font-size: 16px; color: #666; margin-top: 10px;"> Giỏ hàng của bạn đang trống </p> </div>';

            } else {
                const cartSummary = await fetchCartSummary(userId);
                renderMiniCart(cartItems, cartSummary);
            }
        } catch (error) {
            console.error("Error reloading mini cart:", error);
        }
    }
    // Kết thúc xử lý mini card

    document.addEventListener('DOMContentLoaded', async () => {
        const productContainer = document.querySelector('.product-carousel'); // Container chứa sản phẩm

        const topProductContainer = document.querySelector('.top-seller-carousel'); // Container chứa sản phẩm

       
        try {
            // Gọi API lấy danh sách sản phẩm
            const response = await fetch('http://localhost:8080/product?page=0&size=10', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                throw new Error(`Error fetching products: ${response.statusText}`);
            }

            const data = await response.json();
            const products = data.result.result;

            console.log("product:", data);

            productContainer.innerHTML = '';


            for (const product of products) {
                // Gọi API lấy danh sách ảnh của từng sản phẩm

                let productImage = product.images && product.images.length > 0 ? product.images[0] : 'assets/img/default-image.jpg';
                let rating = 0;

                try {
                    // Gọi API để lấy rating
                    const responseRate = await fetch(`http://localhost:8080/review/average?productId=${product.productId}`);
                    const dataRate = await responseRate.json();
                    if (dataRate.code === 200) {
                        rating = Math.round(dataRate.result.result); // Làm tròn số sao
                    }
                } catch (error) {
                    console.error(`Error fetching rating for product ${product.productId}:`, error);
                }

                const productHTML = `
                    <div class="product-item mb-50">
                                <div class="product-thumb">
                                    <a href="product-details.html?id=${product.productId}">
                                        <img src="http://localhost:8080/images/product/${product.images[0]}" alt="">
                                    </a>
                                </div>
                                <div class="product-content">
                                    <h5 class="product-name">
                                        <a href="product-details.html?id=${product.productId}">${product.productName}</a>
                                    </h5>
                                    <div class="ratings mb-2">
                                    ${'<span><i class="ion-android-star"></i></span>'.repeat(rating)}
                                    ${'<span><i class="ion-android-star-outline"></i></span>'.repeat(5 - rating)}
                                </div>
                                    <div class="price-box">
                                        <span class="price-regular">${product.price * (100 - product.discount) / 100} VND</span>
                                        <span class="price-old"><del>${product.price}</del></span>
                                    </div>
                                    <div class="product-action-link">
                                        <a href="#" data-bs-toggle="tooltip" title="Wishlist"><i
                                                class="ion-android-favorite-outline"></i></a>
                                        <a href="product-details.html?id=${product.productId}" data-bs-toggle="tooltip" title="Add To Cart"><i
                                                class="ion-bag"></i></a>
                                        <a href="#" data-bs-toggle="modal" data-bs-target="#quick_view" data-product-id="${product.productId}"> <span
                                                data-bs-toggle="tooltip" title="Quick View"><i
                                                    class="ion-ios-eye-outline"></i></span> </a>
                                    </div>
                                </div>
                            </div>
                `;

                productContainer.insertAdjacentHTML('beforeend', productHTML);
            }

            // Khởi tạo slider sau khi thêm sản phẩm
            $('.product-carousel').slick({
                slidesToShow: 4, // Hiển thị 4 sản phẩm
                infinite: true,
                arrows: true, // Hiển thị nút điều hướng
                prevArrow: '<button type="button" class="slick-prev"><i class="fa fa-angle-left"></i></button>',
                nextArrow: '<button type="button" class="slick-next"><i class="fa fa-angle-right"></i></button>',
                responsive: [
                    {
                        breakpoint: 1024,
                        settings: {
                            slidesToShow: 3
                        }
                    },
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: 2
                        }
                    },
                    {
                        breakpoint: 480,
                        settings: {
                            slidesToShow: 1
                        }
                    }
                ]
            });


            // Add Quick View event listeners
            document.querySelectorAll('[data-bs-target="#quick_view"]').forEach(button => {
                button.addEventListener('click', async (event) => {
                    const productId = event.currentTarget.getAttribute('data-product-id');
                    await fetchQuickViewProduct(productId);
                });
            });
        } catch (error) {
            console.error('Error fetching products or images:', error);
        }

    });

    // Lấy chi tiết sản phẩm từ API và hiển thị vào modal
    async function fetchQuickViewProduct(productId) {
        try {
            let rvs = "No reviews available"; // Giá trị mặc định
            try {
                const rv = await fetch(`http://localhost:8080/review/count?productId=${productId}`);
                const datarv = await rv.json();
                rvs = datarv.result.result; // Nếu fetch và json thành công
            } catch (error) {
                console.error("Error fetching review count:", error); // Ghi log lỗi
            }

            console.log("Re", rvs)

            const response = await fetch(`http://localhost:8080/product/${productId}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                throw new Error(`Failed to fetch product details: ${response.statusText}`);
            }

            const data = await response.json();
            const product = data.result;

            // Hiển thị thông tin sản phẩm vào modal
            document.getElementById('productName-1').innerText = product.productName;
            document.getElementById('currentPrice-1').innerText = `$${(product.price * (100 - product.discount) / 100).toFixed(2)}`;
            document.getElementById('oldPrice-1').innerText = product.discount ? `$${product.price}` : '';
            document.getElementById('description-1').innerText = product.description;
            document.getElementById("qvId").textContent = product.productId;
            document.getElementById("reviews-1").textContent = rvs;

            // Cập nhật hình ảnh chính và hình ảnh thumbnail
            const mainImage = product.images && product.images[0] ? `http://localhost:8080/images/product/${product.images[0]}` : 'http://localhost:8080/images/product/default-image.jpg';
            document.getElementById('mainImage-1').src = mainImage;

            const thumbnails = product.images || [];
            document.getElementById('thumb1-1').src = thumbnails[0] ? `http://localhost:8080/images/product/${thumbnails[0]}` : 'http://localhost:8080/images/product/default-image.jpg';
            document.getElementById('thumb2-1').src = thumbnails[1] ? `http://localhost:8080/images/product/${thumbnails[1]}` : 'http://localhost:8080/images/product/default-image.jpg';
            document.getElementById('thumb3-1').src = thumbnails[2] ? `http://localhost:8080/images/product/${thumbnails[2]}` : 'http://localhost:8080/images/product/default-image.jpg';
            document.getElementById('thumb4-1').src = thumbnails[3] ? `http://localhost:8080/images/product/${thumbnails[3]}` : 'http://localhost:8080/images/product/default-image.jpg';
            document.getElementById('thumb5-1').src = thumbnails[3] ? `http://localhost:8080/images/product/${thumbnails[3]}` : 'http://localhost:8080/images/product/default-image.jpg';

            // Hiển thị modal
            const quickViewModal = new bootstrap.Modal(document.getElementById('quick_view'));
            quickViewModal.show();
        } catch (error) {
            console.error('Error fetching product details:', error);
        }
    }

    // Thêm sự kiện cho các nút Quick View
    document.querySelectorAll('[data-bs-target="#quick_view"]').forEach(button => {
        button.addEventListener('click', (event) => {
            const productId = event.currentTarget.getAttribute('data-product-id');
            const token = localStorage.getItem('token'); // Token từ localStorage
                fetchQuickViewProduct(productId, token);
            
        });
    });

    const id = localStorage.getItem('userId');

    // Hàm để fetch thông tin sản phẩm từ API và cập nhật DOM
    async function fetchProductDetails(productId) {
        try {
            let rvs = "No reviews available"; // Giá trị mặc định
            try {
                const rv = await fetch(`http://localhost:8080/review/count?productId=${productId}`);
                const datarv = await rv.json();
                rvs = datarv.result.result; // Nếu fetch và json thành công
            } catch (error) {
                console.error("Error fetching review count:", error); // Ghi log lỗi
            }


            const response = await fetch(`http://localhost:8080/product/${productId}`);
            const token = localStorage.getItem('token');
            const id = localStorage.getItem('userId');
            if (!response.ok) {
                throw new Error('Error fetching product details');
            }

            const data = await response.json();
            const product = data.result;

            // Cập nhật thông tin sản phẩm vào DOM
            document.getElementById('productName').innerText = product.productName;
            document.getElementById('currentPrice').innerText = `$${(product.price * (100 - product.discount) / 100).toFixed(2)}`;
            document.getElementById('oldPrice').innerText = product.discount ? `$${product.price}` : '';
            document.getElementById('description').innerText = product.description;
            document.getElementById('des').innerText = product.description;
            document.getElementById("reviews").textContent = rvs;


            // Cập nhật hình ảnh chính
            const mainImage = `http://localhost:8080/images/product/${product.images[0]}`;
            document.getElementById('mainImage').src = mainImage;

            const thumbnails = product.images || [];
            console.log("thm", thumbnails)
            document.getElementById('thumb1').src = thumbnails[0] ? `http://localhost:8080/images/product/${thumbnails[0]}` : 'http://localhost:8080/images/product/default-image.jpg';
            document.getElementById('thumb2').src = thumbnails[1] ? `http://localhost:8080/images/product/${thumbnails[1]}` : 'http://localhost:8080/images/product/default-image.jpg';
            document.getElementById('thumb3').src = thumbnails[2] ? `http://localhost:8080/images/product/${thumbnails[2]}` : 'http://localhost:8080/images/product/default-image.jpg';
            document.getElementById('thumb4').src = thumbnails[3] ? `http://localhost:8080/images/product/${thumbnails[3]}` : 'http://localhost:8080/images/product/default-image.jpg';

        } catch (error) {
            console.error(error);
        }
    }

    async function fetchAndDisplayProductVariants(productId) {
        try {
            const response = await fetch(`http://localhost:8080/product/variants/${productId}`);
            if (!response.ok) throw new Error('Failed to fetch product variants');

            const data = await response.json();
            const variants = data.result;
            const variantsTableBody = document.getElementById('product-variants');
            variantsTableBody.innerHTML = ''; // Xóa dữ liệu cũ

            variants.forEach(variant => {
                const row = document.createElement('tr');

                const nameCell = document.createElement('td');
                nameCell.textContent = variant.size; // Tên biến thể
                row.appendChild(nameCell);

                const valueCell = document.createElement('td');
                valueCell.textContent = variant.color; // Giá trị biến thể
                row.appendChild(valueCell);

                variantsTableBody.appendChild(row);
            });
        } catch (error) {
            console.error('Error fetching product variants:', error);
        }
    }

    // Phóng to ảnh chính khi di chuột
    const mainImage = document.getElementById('mainImage');
    const thumbnails = document.querySelectorAll('.thumbnail');
    const mainImage_1 = document.getElementById('mainImage-1');
    const thumbnails_1 = document.querySelectorAll('.thumbnail-1');

    // Thay đổi ảnh chính khi bấm vào thumbnail
    thumbnails.forEach(thumbnail => {
        thumbnail.addEventListener('click', (event) => {
            const newImageSrc = event.target.src;
            mainImage.src = newImageSrc;
        });
    });
    thumbnails_1.forEach(thumbnail => {
        thumbnail.addEventListener('click', (event) => {
            const newImageSrc = event.target.src;
            mainImage_1.src = newImageSrc;
        });
    });

    // Di chuột để phóng to vùng ảnh
    mainImage.addEventListener('mousemove', (event) => {
        const bounds = mainImage.getBoundingClientRect();
        const xPercent = ((event.clientX - bounds.left) / bounds.width) * 100;
        const yPercent = ((event.clientY - bounds.top) / bounds.height) * 100;
        mainImage.style.transformOrigin = `${xPercent}% ${yPercent}%`;
    });
    mainImage_1.addEventListener('mousemove', (event) => {
        const bounds = mainImage_1.getBoundingClientRect();
        const xPercent = ((event.clientX - bounds.left) / bounds.width) * 100;
        const yPercent = ((event.clientY - bounds.top) / bounds.height) * 100;
        mainImage_1.style.transformOrigin = `${xPercent}% ${yPercent}%`;
    });
    mainImage.addEventListener('mouseleave', () => {
        mainImage.style.transformOrigin = 'center center';
    });
    mainImage_1.addEventListener('mouseleave', () => {
        mainImage_1.style.transformOrigin = 'center center';
    });

    // logic thêm giỏ hàng
    document.querySelectorAll('.color-box').forEach((box) => {
        box.addEventListener('click', function () {
            document.querySelectorAll('.color-box').forEach((b) => b.classList.remove('selected'));
            this.classList.add('selected');
            console.log("Selected Color:", this.getAttribute('data-color'));
        });
    });

    document.querySelectorAll('.size-box').forEach((box) => {
        box.addEventListener('click', function () {
            document.querySelectorAll('.size-box').forEach((b) => b.classList.remove('selected'));
            this.classList.add('selected');
            console.log("Selected Size:", this.getAttribute('data-size'));
        });
    });

    async function addToCart(id, productId, quantity, size, color) {
        const apiUrl = `http://localhost:8080/cart?userId=${id}&productId=${productId}&quantity=${quantity}&size=${size}&color=${color}`;
        
        if (!id) {
            Swal.fire({
                icon: 'warning',
                title: 'Thông báo',
                text: 'Bạn cần đăng nhập.',
                confirmButtonColor: '#3085d6',
            });
            return;
        }

        try {
            const response = await fetch(apiUrl, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    // 'Authorization': `Bearer ${token}`, // Thêm nếu cần xác thực
                },
            });

            if (!response.ok) {
                throw new Error(`Failed to add to cart: ${response.status}`);
            }

            // Kiểm tra Content-Type để xử lý phản hồi phù hợp
            const contentType = response.headers.get("Content-Type");
            let data;

            if (contentType && contentType.includes("application/json")) {
                data = await response.json(); // Xử lý nếu là JSON
            } else {
                data = await response.text(); // Xử lý nếu là text
            }

            // Kiểm tra nội dung phản hồi
            if (typeof data === "string") {
                console.log("Response message:", data);
                alert(data); // Hiển thị thông báo cho người dùng
                location.reload();
            } else if (data.code === 200) {
                console.log("Product added to cart successfully:", data.message);
                alert(data.message || "Product added successfully!");
            } else {
                console.error("Error adding to cart:", data.message);
                alert("Failed to add product to cart!");
            }
        } catch (error) {
            console.error("Error during add-to-cart operation:", error);
            alert("An error occurred while adding the product to the cart.");
        }
    }

    document.getElementById("addToCart").addEventListener("click", function () {
        const selectedColor = document.querySelector('.color-box.selected')?.getAttribute('data-color');
        const selectedSize = document.querySelector('.size-box.selected')?.getAttribute('data-size');
        const quantity = document.getElementById("quantityInput-1").value;
        const qvId = document.getElementById("qvId").textContent.trim();
        console.log("abc" + qvId);

        const min_1 = document.getElementById("quantityInput-1").min;
        const max_2 = document.getElementById("quantityInput-1").max;

        if (!selectedColor || !selectedSize) {
            alert("Vui lòng chọn cả màu sắc và kích cỡ.");
            return;
        }


        console.log("Add to Cart:", { color: selectedColor, size: selectedSize, quantity });

        // Logic thêm sản phẩm vào giỏ hàng
        if(quantity > min_1 && quantity <= max_2){
            addToCart(userId, qvId, quantity, selectedSize, selectedColor);
        } else {
            alert("Số lượng không hợp lệ!");
        }
    });



    // Hàm để lấy tham số từ URL
    function getUrlParameter(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param); // Trả về giá trị của tham số
    }


    // Gọi API khi trang được tải
    window.addEventListener('DOMContentLoaded', () => {
        // Lấy productId từ URL
        const productId = getUrlParameter('id');
        if (productId) {
            // Gọi hàm để fetch chi tiết sản phẩm
            fetchProductDetails(productId);
            fetchAndDisplayProductVariants(productId);

            document.getElementById("addToCart2").addEventListener("click", function () {
                const selectedColor = document.querySelector('.color-box.selected')?.getAttribute('data-color');
                const selectedSize = document.querySelector('.size-box.selected')?.getAttribute('data-size');
                const quantity = parseInt(document.getElementById("quantityInput").value);

                const qvId = document.getElementById("qvId").textContent.trim();
                console.log("abc" + qvId);

                const min = parseInt(document.getElementById("quantityInput").min);
                const max = parseInt(document.getElementById("quantityInput").max);

                if (!selectedColor || !selectedSize) {
                    alert("Please select both color and size.");
                    return;
                }


                console.log("Add to Cart:", { color: selectedColor, size: selectedSize, quantity });

                // Logic thêm sản phẩm vào giỏ hàng
                if (isNaN(quantity) || quantity <= min || quantity > max) {
                    alert("So luong khong hop le");
                    return;
                }
                    addToCart(id, productId, quantity, selectedSize, selectedColor);
                
            });
        } else {
            console.error('Product ID not found in URL');
            // Bạn có thể chuyển hướng về trang danh sách hoặc hiển thị thông báo lỗi ở đây
        }
    });

    //số lượng sp trong giỏ hàng
    $.ajax({
        url: "http://localhost:8080/cart/quantity",
        data: { userId: id },
        type: "GET",
        success: function (response) {
            let numberOfProduct = response.result;
            console.log("Aa", response);
            $('#cart-quantity').text(numberOfProduct)
        }
    })

    document.addEventListener("DOMContentLoaded", async function () {
        const userId = localStorage.getItem("userId"); // Lấy ID từ localStorage
        const token = localStorage.getItem("token"); // Lấy token từ localStorage
        // Kiểm tra nếu không có ID hoặc token
       

        // API URLs
        const UserUrl = `http://localhost:8080/user/${userId}`;
        // Fetch user data
        try {
            const response = await fetch(UserUrl, {
                method: "GET",
                headers: {
                    Authorization: `Bearer ${token}`,
                    "Content-Type": "application/json",
                },
            });
            const data = await response.json();
            const user = data.result.result;

            const avatarSmall = user.avatar
                ? `http://localhost:8080/images/avatar/${user.avatar}`
                : "assets/img/about/avatar.jpg";

            // Gán URL của avatar vào thẻ <img> trong .user-thumbnail
            const userImage = document.querySelector(".user-thumbnail .user-image");
            if (userImage) {
                userImage.src = avatarSmall;
            }
        } catch (error) {
            console.error("Error fetching user data:", error);
        };
    });



    document.addEventListener('DOMContentLoaded', async () => {
        const reviewList = document.getElementById('review-list');
        const reviewCount = document.getElementById('review-count');
        const reviewForm = document.getElementById('reviewForm');
        const submitReviewButton = document.getElementById('submitReview');

        // Lấy userId từ localStorage và productId từ URL
        const userId = localStorage.getItem('userId');
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');



        // Hàm gọi API để lấy danh sách bình luận
        async function fetchReviews() {
            try {
                const response = await fetch(`http://localhost:8080/review?productId=${productId}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });
        
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
        
                const data = await response.json();
                console.log('API response:', data);
        
                // Xử lý khi không có đánh giá
                if (!data.result || !data.result.result) {
                    reviewList.innerHTML = '<p>No reviews available.</p>';
                    reviewCount.textContent = `0 review(s)`;
                    return;
                }
        
                // Đảm bảo "result" là mảng
                const reviews = Array.isArray(data.result.result) ? data.result.result : [data.result.result];
        
                // Lấy thông tin từng user và cập nhật giao diện
                const reviewElements = await Promise.all(
                    reviews.map(async (review) => {
                        try {
                            const userResponse = await fetch(`http://localhost:8080/user/${review.userId}`, {
                                method: 'GET',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                            });
        
                            if (!userResponse.ok) {
                                throw new Error(`HTTP error! Status: ${userResponse.status}`);
                            }
        
                            const userData = await userResponse.json();
        
                            return `
                                <div class="total-reviews">
                                    <div class="rev-avatar">
                                        <img src="assets/img/about/avatar.jpg" alt="">
                                    </div>
                                    <div class="review-box">
                                        <div class="ratings">
                                            ${Array(review.rating)
                                                .fill('<span><i class="fa fa-star"></i></span>')
                                                .join('')}
                                            ${Array(5 - review.rating)
                                                .fill('<span><i class="fa fa-star-o"></i></span>')
                                                .join('')}
                                        </div>
                                        <div class="post-author">
                                            <p><span>${userData.result.result.username} -</span> ${new Date(review.createdAt).toLocaleDateString()}</p>
                                        </div>
                                        <p>${review.comment}</p>
                                    </div>
                                </div>
                            `;
                        } catch (error) {
                            console.error('Error fetching user details:', error);
                            return `
                                <div class="total-reviews">
                                    <div class="review-box">
                                        <p>Error loading user information for review.</p>
                                    </div>
                                </div>
                            `;
                        }
                    })
                );
        
                // Cập nhật giao diện
                reviewCount.textContent = `${reviews.length} review(s)`;
                reviewList.innerHTML = reviewElements.join('');
        
            } catch (error) {
                console.error('Error fetching reviews:', error);
                reviewList.innerHTML = '<p>Error loading reviews. Please try again later.</p>';
                reviewCount.textContent = `0 review(s)`;
            }
        }
        

        // Hàm thêm bình luận
        async function addReview() {
            const reviewContent = document.getElementById('reviewContent').value;
            const rating = document.querySelector('input[name="rating"]:checked').value;

            const reviewData = {
                comment: reviewContent,
                rating: parseInt(rating, 10),
            };

            try {
                const response = await fetch(`http://localhost:8080/review?userId=${userId}&productId=${productId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(reviewData),
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                const data = await response.json();
                console.log('Review added successfully:', data.result);

                // Làm rỗng form
                document.getElementById('reviewContent').value = '';
                document.querySelector('input[name="rating"]:checked').checked = false;

                // Cập nhật danh sách bình luận
                await fetchReviews();
            } catch (error) {
                console.error('Error adding review:', error);
                alert('Failed to add review. Please try again later.');
            }
        }

        // Gắn sự kiện cho nút "Đăng"
        submitReviewButton.addEventListener('click', async () => {
            await addReview();
        });

        // Tải danh sách bình luận khi tải trang
        await fetchReviews();
    });


    // Lấy chi tiết sản phẩm từ API khi thay đổi màu sắc hoặc kích thước
    async function updateAvailability(productId, selectedColor, selectedSize) {
        try {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            const response = await fetch(`http://localhost:8080/product/sum?productId=${productId}&color=${selectedColor}&size=${selectedSize}`);
            if (!response.ok) {
                throw new Error(`Failed to fetch product availability: ${response.statusText}`);
            }
            const rs = await response.json();
            const data = rs.result;

            console.log("rs",data)
            document.getElementById("availability").textContent = data; // Cập nhật availability
            document.getElementById("quantityInput").max = data;

            document.getElementById("availability-1").textContent = data; // Cập nhật availability
            document.getElementById("quantityInput-1").max = data;
        } catch (error) {
            console.error("Error fetching availability:", error);
            document.getElementById("availability").textContent = "0";
        }
    }

    // Xử lý sự kiện khi chọn màu sắc
    document.querySelectorAll('.color-box').forEach(colorBox => {
        colorBox.addEventListener('click', () => {
            const selectedColor = colorBox.getAttribute('data-color');
            const selectedSize = document.querySelector('.size-box.selected')?.getAttribute('data-size') || '';
            const productId = document.getElementById("qvId").textContent; // Lấy productId từ modal
            updateAvailability(productId, selectedColor, selectedSize);
            
            // Thay đổi trạng thái lựa chọn
            document.querySelectorAll('.color-box').forEach(box => box.classList.remove('selected'));
            colorBox.classList.add('selected');
        });
    });

    // Xử lý sự kiện khi chọn kích thước
    document.querySelectorAll('.size-box').forEach(sizeBox => {
        sizeBox.addEventListener('click', () => {
            const selectedSize = sizeBox.getAttribute('data-size');
            const selectedColor = document.querySelector('.color-box.selected')?.getAttribute('data-color') || '';
            const productId = document.getElementById("qvId").textContent; // Lấy productId từ modal
            updateAvailability(productId, selectedColor, selectedSize);
            
            // Thay đổi trạng thái lựa chọn
            document.querySelectorAll('.size-box').forEach(box => box.classList.remove('selected'));
            sizeBox.classList.add('selected');
        });
    });

    document.getElementById("searchBtn").addEventListener("click", async function (e) {
        e.preventDefault(); 
    
        const query = document.getElementById("searchInput").value.trim();
        if (!query) {
            const resultsContainer = document.getElementById("searchResults");
            resultsContainer.innerHTML = "<p>Nhập thông tin cần tìm kiếm.</p>";
            resultsContainer.style.display = "block"; 
            return;
        }
    
        console.log("Search query:", query); 
    
        try {
            // Gửi yêu cầu đến API backend
            const response = await fetch(`http://localhost:8080/product/name?search=productName:like:${encodeURIComponent(query)}&page=0&size=10`, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json"
                }
            });
    
            console.log("Response status:", response.status); 
    
            if (!response.ok) {
                throw new Error(`Failed to fetch data from API: ${response.status}`);
            }
    
            const data = await response.json();
            console.log("Response data:", data); 
    
            const resultsContainer = document.getElementById("searchResults");
            resultsContainer.innerHTML = ""; 
    
            if (data.result.result && data.result.result.length > 0) {
                data.result.result.forEach(item => {
                    const resultItem = document.createElement("div");
                    resultItem.classList.add("result-item");
            
                    const link = document.createElement("a");
                    link.href = `product-details.html?id=${item.productId}`;
                    link.classList.add("result-link");
            
                    link.innerHTML = `
                        <div class="result-thumbnail">
                            <img src="http://localhost:8080/images/product/${item.images?.[0] || 'default-image.jpg'}" alt="${item.productName}">
                        </div>
                        <div class="result-details">
                            <span class="product-name">${item.productName}</span>
                            <span class="product-price">Giá: ${(item.price * (100 - item.discount) / 100).toLocaleString()} VND</span>
                        </div>
                    `;
            
                    resultItem.appendChild(link); 
                    resultsContainer.appendChild(resultItem);  
                });
                resultsContainer.style.display = "block";
            } else {
                resultsContainer.innerHTML = "<p>Không có sản phẩm nào được tìm thấy.</p>";
                resultsContainer.style.display = "block";
            }
                
        } catch (error) {
            console.error("Error:", error.message); 
            const resultsContainer = document.getElementById("searchResults");
            resultsContainer.innerHTML = "<p>Lỗi tìm kiếm.</p>";
            resultsContainer.style.display = "block"; 
        }
    });

    document.addEventListener("click", function (event) {
        const resultsContainer = document.getElementById("searchResults");
        const searchInput = document.getElementById("searchInput");
        const searchBtn = document.getElementById("searchBtn");

        if (!resultsContainer.contains(event.target) && event.target !== searchInput && event.target !== searchBtn) {
            resultsContainer.style.display = "none"; 
        }
    });


</script>

<style>
    /* modal */
    .img-thumbnail {
        width: 125px;
        height: 125px;
    }

    .price-box .price-regular {
        font-size: 18px;
        font-weight: bold;
        color: #000;
    }

    .price-box .price-old {
        font-size: 16px;
        text-decoration: line-through;
    }

    .availability span {
        font-weight: bold;
    }

    .product-item {
        margin: 0 10px;
        text-align: center;
    }

    .product-thumb img {
        max-width: 100%;
        height: auto;
        border-radius: 5px;
    }

    .zoomable {
        transition: transform 0.2s ease-in-out;
        cursor: zoom-in;
    }

    .product-large-slider:hover .zoomable {
        transform: scale(2);
        /* Phóng to khi hover */
        cursor: zoom-out;
    }

    .thumbnail {
        cursor: pointer;
    }

    .product-large-slider {
        position: relative;
        overflow: hidden;
    }

    .user-thumbnail .user-image {
        width: 30px;
        height: 30px;
        border-radius: 30%;
        object-fit: cover;
        border: 1px solid #ddd;
    }

    .user-thumbnail a {
        display: inline-block;
        text-decoration: none;
    }

    .color-box {
        width: 30px;
        height: 30px;
        border: 2px solid black;
        cursor: pointer;
        border-radius: 50%;
        /* Làm ô màu thành hình tròn */
    }

    .color-box.selected {
        border: 2px solid #3cfd6c;
        /* Viền để phân biệt ô được chọn */
    }

    .size-box {
        width: 40px;
        height: 40px;
        line-height: 40px;
        text-align: center;
        border: 2px solid #ddd;
        cursor: pointer;
        border-radius: 5px;
        font-weight: bold;
    }

    .size-box.selected {
        border: 2px solid #000;
        background-color: #f0f0f0;
    }
    
     /* cart */
     .minicart-inner-content {
        display: flex;
        flex-direction: column;
        height: 100%; /* Chiều cao toàn phần của nội dung */
    }
    
    .minicart-item-wrapper {
        flex-grow: 1; /* Phần danh sách sản phẩm mở rộng để chiếm không gian còn lại */
        overflow-y: auto; /* Kích hoạt cuộn dọc */
    }

    /* footer */
    /* Thiết lập mặc định cho footer */
.footer-wrapper {
    padding: 20px 0;
}

.footer-widget-area {
    background-color: #f9f9f9;
}

.widget-item {
    margin-bottom: 20px;
}

.location-wrap li {
    font-size: 16px;
    margin-bottom: 10px;
}

/* Thay đổi bố cục và kích thước cho màn hình nhỏ hơn */
@media (max-width: 992px) {
    .col-xl-5, .col-lg-3, .col-md-6 {
        flex: 0 0 50%;
        max-width: 50%;
    }

    .col-xl-3, .col-lg-3, .col-md-4 {
        flex: 0 0 100%;
        max-width: 100%;
        text-align: center; /* Căn giữa nội dung */
    }

    iframe {
        width: 100%;
        height: 150px; /* Điều chỉnh chiều cao iframe */
    }
}

@media (max-width: 576px) {
    .location-wrap li {
        font-size: 14px; /* Thu nhỏ font chữ */
    }

    .col-xl-5, .col-lg-3, .col-md-6,
    .col-xl-3, .col-lg-3, .col-md-4 {
        flex: 0 0 100%;
        max-width: 100%;
    }

    iframe {
        height: 120px; /* Điều chỉnh thêm cho màn hình nhỏ */
    }
}

.search-results {
    display: none;
    position: absolute;
    top: 73%;
    left: 28%;
    width: 500px;
    border: 1px solid #ccc;
    max-height: 300px;
    overflow-y: auto;
    background-color: white;
    z-index: 9999;
}

.result-item {
    display: flex;
    border-bottom: 1px solid #ccc;
}

.result-link {
    display: flex;
    width: 100%;
    text-decoration: none;  
    color: #000;
}

.result-thumbnail {
    margin-right: 10px;
}

.result-thumbnail img {
    width: 50px;
    height: 50px;
}

.result-details {
    display: flex;
    flex-direction: column;  
    justify-content: center;  
}

.result-item + .result-item {
    border-top: 1px solid #ccc;
}

.result-item::after {
    content: "";
}
</style>