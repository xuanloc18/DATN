<!DOCTYPE html>
<html class="no-js" lang="zxx">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="meta description">
    <title>Ananas - Shoes Store</title>
    <!--=== Favicon ===-->
    <link rel="shortcut icon" href="assets/img/favicon.ico" type="image/x-icon" />
    <!--=== All Plugins CSS ===-->
    <link href="assets/css/plugins.css" rel="stylesheet">
    <!--=== All Vendor CSS ===-->
    <link href="assets/css/vendor.css" rel="stylesheet">
    <!--=== Main Style CSS ===-->
    <link href="assets/css/style.css" rel="stylesheet">
    <!-- Modernizer JS -->
    <script src="assets/js/modernizr-2.8.3.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>

<body>

    <!-- Start Header Area -->
    <header class="header-area">
        <!-- main header start -->
        <div class="main-header d-none d-lg-block">
        

            <!-- header middle area start -->
            <div class="header-main-area sticky">
                <div class="container">
                    <div class="row align-items-center position-relative">
                        <!-- start logo area -->
                        <div class="col-lg-2">
                            <div class="logo">
                                <a href="index-2.html">
                                    <img src="assets/img/logo/logo.png" alt="">
                                </a>
                            </div>
                        </div>
                        <!-- start logo area -->
                </div>
            </div>
            <!-- header middle area end -->
        </div>
        <!-- main header start -->
    </header>
    <!-- end Header Area -->

    <!-- main wrapper start -->
    <main>
        <!-- login register wrapper start -->
        <div class="login-register-wrapper section-padding">
            <div class="container">
                <div class="member-area-from-wrap">
                    <div class="row">
                        <!-- Login Content Start -->
                        <div class="col-lg-12">
                            <div class="login-reg-form-wrap">
                                <h2>Đăng nhập</h2>
                                <form id="loginForm" action="javascript:void(0);">
                                    <div class="single-input-item">
                                        <input type="text" id="loginUsername" placeholder="Nhập email hoặc Username" required />
                                    </div>
                                    <div class="single-input-item">
                                        <input type="password" id="loginPassword" placeholder="Nhập mật khẩu" required />
                                    </div>
                                    <div class="single-input-item">
                                        <div class="login-reg-form-meta d-flex align-items-center justify-content-between">
                                            <div class="remember-meta">
                                                <div class="custom-control custom-checkbox">
                                                    <input type="checkbox" class="custom-control-input" id="rememberMe">
                                                    <label class="custom-control-label" for="rememberMe">Lưu đăng nhập</label>
                                                </div>
                                            </div>
                                            <a href="#"  class="forget-pwd">Quên mật khẩu?</a>
                                        </div>
                                    </div>
                                    <div class="single-input-item">
                                        <button type="submit" class="btn">Đăng nhập</button>
                                    </div>
                                    <div class="single-input-item">
                                        <p>Không có tài khoản? <a href="register.html">Đăng ký</a></p>
                                    </div>
                                </form>
                                <!-- Modal Forget Password -->
                                <div id="forgotPasswordModal" style="display:none; padding-top:50px">
                                    <div class="modal-content">
                                        <form id="forgotPasswordForm" action="javascript:void(0);">
                                            <h3>Quên mật khẩu</h3>
                                            <div class="single-input-item">
                                                <input type="email" id="forgotPasswordEmail" placeholder="Nhập email để lấy mật khẩu" required />
                                            </div>
                                            <div class="single-input-item">
                                                <button type="submit" class="btn">Gửi</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Login Content End -->
                    </div>
                </div>
            </div>
        </div>
        <!-- login register wrapper end -->
    </main>
    <!-- main wrapper end -->

    <!-- Start Footer Area Wrapper -->
    <footer class="footer-wrapper">
        <!-- footer main area start -->
        <div class="footer-widget-area">
            <div class="container">
                <div class="row mtn-4">
                    <!-- footer widget item start -->
                    <div class="col-xl-5 col-lg-3 col-md-6">
                        <div class="widget-item mt-4">
                            <h5 class="widget-title">Thông tin liên hệ</h5>
                            <div class="widget-body">
                                <ul class="location-wrap">
                                    <li><i class="ion-ios-location-outline"></i>Minh Khai Ward, Bac Tu Liem District, Hanoi City.</li>
                                    <li><i class="ion-ios-email-outline"></i>Mail: <a href="mailto:huongdao2322005@gmail.com">ananas@gmail.com</a></li>
                                    <li><i class="ion-ios-telephone-outline"></i>Phone: <a href="%2b0025425456554.html">+0123456789</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-3 col-md-4"></div>
                    <!-- footer widget item end -->
                    <div class="col-xl-3 col-lg-3 col-md-4">
                        <iframe
                            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3723.4737884515107!2d105.73253187608918!3d21.053730980601838!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31345457e292d5bf%3A0x20ac91c94d74439a!2zVHLGsOG7nW5nIMSQ4bqhaSBo4buNYyBDw7RuZyBuZ2hp4buHcCBIw6AgTuG7mWk!5e0!3m2!1svi!2s!4v1733187950170!5m2!1svi!2s"
                            width="400" height="200" style="border:0;" allowfullscreen="" loading="lazy"
                            referrerpolicy="no-referrer-when-downgrade"></iframe>
                    </div>
                    <!-- footer widget item end -->
                </div>
            </div>
        </div>
        <!-- footer main area end -->

    
    </footer>
    <!-- End Footer Area Wrapper -->

    <!-- Scroll to top start -->
    <div class="scroll-top not-visible">
        <i class="fa fa-angle-up"></i>
    </div>
    <!-- Scroll to Top End -->

    <!--=======================Javascript============================-->
    <!--=== All Vendor Js ===-->
    <script src="assets/js/vendor.js"></script>
    <!--=== All Plugins Js ===-->
    <script src="assets/js/plugins.js"></script>
    <!--=== Active Js ===-->
    <script src="assets/js/active.js"></script>
</body>
    

</html>


<script>
    const API_BASE_URL = "http://localhost:8080/auth"; 

    function parseJwt(token) {
        const base64Url = token.split('.')[1]; // Lấy phần payload
        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        const jsonPayload = decodeURIComponent(
            atob(base64)
                .split('')
                .map(c => `%${('00' + c.charCodeAt(0).toString(16)).slice(-2)}`)
                .join('')
        );
    
        return JSON.parse(jsonPayload);
    }
    

    // Xử lý form đăng nhập
    document.getElementById("loginForm").addEventListener("submit", async function (e) {
        e.preventDefault();
    
        // Lấy giá trị từ form
        const identifier = document.getElementById("loginUsername").value.trim(); // Có thể là username hoặc email
        const password = document.getElementById("loginPassword").value.trim();
    
        if (!identifier || !password) {
            alert("Vui lòng nhập cả email/Tên đăng nhập và mật khẩu");
            return;
        }
    
        try {
            const response = await fetch(`${API_BASE_URL}/login`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ identifier, password }), // Sử dụng trường chung 'identifier'
            });
        
            // Kiểm tra phản hồi từ server
            if (response.ok) {
                const result = await response.json();
                const token = result.result.result.token;
        
                const decodedToken = parseJwt(token);
                console.log("Decoded token:", decodedToken);
        
                console.log("Server response:", result.result.result); // In ra toàn bộ phản hồi từ server
                
                // Lưu token vào LocalStorage
                localStorage.setItem("token", result.result.result.token);
                localStorage.setItem("userId", result.result.result.userId);
                localStorage.setItem("username", result.result.result.username);
                localStorage.setItem("email", identifier);
                localStorage.setItem("password", password);
        
                // Chuyển hướng người dùng
                if (decodedToken.scope === "Admin") {
                    Swal.fire({
                        icon: 'success',
                        title: 'Đăng nhập thành công',
                        text: 'Welcome, Admin!',
                        confirmButtonColor: '#3085d6',
                    }).then(() => {
                        window.location.href = "index(2).html";
                    });
                } else if (decodedToken.scope === "User") {
                    Swal.fire({
                        icon: 'success',
                        title: 'Đăng nhập thành công',
                        text: 'Welcome!',
                        confirmButtonColor: '#3085d6',
                    }).then(() => {
                        window.location.href = "index-2.html";
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Unknown Role',
                        text: 'Please contact support.',
                        confirmButtonColor: '#d33',
                    });
                }
            } else {
                // Nếu thông tin đăng nhập sai hoặc lỗi từ server
                const errorData = await response.json();
                Swal.fire({
                    icon: 'error',
                    title: 'Đăng nhập thất bại',
                    text: 'Kiểm tra lại Tên đăng nhập/email và mật khẩu.',
                    confirmButtonColor: '#d33',
                });
            }
        } catch (error) {
            console.error("Error logging in:", error);
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'An error occurred while logging in. Please try again later.',
                confirmButtonColor: '#d33',
            });
        }
        
    });
    

    // Lưu thông tin khi chọn "Remember Me"
    document.getElementById("loginForm").addEventListener("submit", function () {
        const rememberMe = document.getElementById("rememberMe").checked;

        if (rememberMe) {
            localStorage.setItem("rememberMe", true);
        } else {
            localStorage.removeItem("rememberMe");
        }
    });

    // Tự động điền thông tin khi đã chọn "Remember Me"
    window.addEventListener("load", function () {
        const rememberMe = localStorage.getItem("rememberMe");
        if (rememberMe) {
            const email = localStorage.getItem("email");
            const password = localStorage.getItem("password");
            document.getElementById("loginUsername").value = email || "";
            document.getElementById("loginPassword").value = password || "";
            document.getElementById("rememberMe").checked = true;
        }
    });


    // Hiển thị modal quên mật khẩu khi nhấp vào liên kết
    document.querySelector(".forget-pwd").addEventListener("click", function (e) {
        e.preventDefault();
        document.getElementById("forgotPasswordModal").style.display = "block";
    });

    // Xử lý form quên mật khẩu
    document.getElementById("forgotPasswordForm").addEventListener("submit", async function (e) {
        e.preventDefault();
        const email = document.getElementById("forgotPasswordEmail").value;
    
        try {
            const response = await fetch(`http://localhost:8080/user/forgot-password`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ email }),
            });
    
            console.log("Response:", response);
    
            if (response.ok) {
                Swal.fire({
                    icon: 'success',
                    title: 'Thành công!',
                    text: 'Mật khẩu mới đã được gửi tới email của bạn.',
                    confirmButtonColor: '#3085d6',
                }).then(() => {
                    // Đóng modal sau khi thông báo thành công
                    document.getElementById("forgotPasswordModal").style.display = "none";
                });
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Thất bại!',
                    text: 'Lỗi khi cấp lại mật khẩu.Vui lòng kiểm tra lại email của bạn.',
                    confirmButtonColor: '#d33',
                });
            }
        } catch (error) {
            console.error("Error sending password reset email:", error);
            Swal.fire({
                icon: 'error',
                title: 'Error!',
                text: 'An unexpected error occurred. Please try again later.',
                confirmButtonColor: '#d33',
            });
        }
    });
    

</script>

<style>
    /* Thiết lập mặc định cho footer */
.footer-wrapper {
    padding: 20px 0;
}

.footer-widget-area {
    background-color: #f9f9f9;
}

.widget-item {
    margin-bottom: 20px;
}

.location-wrap li {
    font-size: 16px;
    margin-bottom: 10px;
}

/* Thay đổi bố cục và kích thước cho màn hình nhỏ hơn */
@media (max-width: 992px) {
    .col-xl-5, .col-lg-3, .col-md-6 {
        flex: 0 0 50%;
        max-width: 50%;
    }

    .col-xl-3, .col-lg-3, .col-md-4 {
        flex: 0 0 100%;
        max-width: 100%;
        text-align: center; /* Căn giữa nội dung */
    }

    iframe {
        width: 100%;
        height: 150px; /* Điều chỉnh chiều cao iframe */
    }
}

@media (max-width: 576px) {
    .location-wrap li {
        font-size: 14px; /* Thu nhỏ font chữ */
    }

    .col-xl-5, .col-lg-3, .col-md-6,
    .col-xl-3, .col-lg-3, .col-md-4 {
        flex: 0 0 100%;
        max-width: 100%;
    }

    iframe {
        height: 120px; /* Điều chỉnh thêm cho màn hình nhỏ */
    }
}

</style>