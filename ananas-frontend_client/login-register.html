<!DOCTYPE html>
<html class="no-js" lang="zxx">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="meta description">
    <title>Ananas - Shoes Store</title>
    <!--=== Favicon ===-->
    <link rel="shortcut icon" href="assets/img/favicon.ico" type="image/x-icon" />
    <!--=== All Plugins CSS ===-->
    <link href="assets/css/plugins.css" rel="stylesheet">
    <!--=== All Vendor CSS ===-->
    <link href="assets/css/vendor.css" rel="stylesheet">
    <!--=== Main Style CSS ===-->
    <link href="assets/css/style.css" rel="stylesheet">
    <!-- Modernizer JS -->
    <script src="assets/js/modernizr-2.8.3.min.js"></script>

    <!--[if lt IE 9]>
<script src="//oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="//oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>

<body>

    <!-- Start Header Area -->
    <header class="header-area">
        <!-- main header start -->
        <div class="main-header d-none d-lg-block">
        

            <!-- header middle area start -->
            <div class="header-main-area sticky">
                <div class="container">
                    <div class="row align-items-center position-relative">
                        <!-- start logo area -->
                        <div class="col-lg-2">
                            <div class="logo">
                                <a href="index-2.html">
                                    <img src="assets/img/logo/logo.png" alt="">
                                </a>
                            </div>
                        </div>
                        <!-- start logo area -->
                </div>
            </div>
            <!-- header middle area end -->
        </div>
        <!-- main header start -->
    </header>
    <!-- end Header Area -->

    <!-- off-canvas menu start -->
    <aside class="off-canvas-wrapper">
        <div class="off-canvas-overlay"></div>
        <div class="off-canvas-inner-content">
            <div class="btn-close-off-canvas">
                <i class="ion-android-close"></i>
            </div>

            <div class="off-canvas-inner">
                <!-- search box start -->
                <div class="search-box-offcanvas">
                    <form>
                        <input type="text" placeholder="Search Here...">
                        <button class="search-btn"><i class="ion-ios-search-strong"></i></button>
                    </form>
                </div>
                <!-- search box end -->
            </div>
        </div>
    </aside>
    <!-- off-canvas menu end -->

    <!-- main wrapper start -->
    <main>
        <!-- login register wrapper start -->
        <div class="login-register-wrapper section-padding">
            <div class="container">
                <div class="member-area-from-wrap">
                    <div class="row">
                        <!-- Login Content Start -->
                        <div class="col-lg-6">
                            <div class="login-reg-form-wrap">
                                <h2>Sign In</h2>
                                <form id="loginForm" action="javascript:void(0);">
                                    <div class="single-input-item">
                                        <input type="text" id="loginUsername" placeholder="Email or Username" required />
                                    </div>
                                    <div class="single-input-item">
                                        <input type="password" id="loginPassword" placeholder="Enter your Password" required />
                                    </div>
                                    <div class="single-input-item">
                                        <div class="login-reg-form-meta d-flex align-items-center justify-content-between">
                                            <div class="remember-meta">
                                                <div class="custom-control custom-checkbox">
                                                    <input type="checkbox" class="custom-control-input" id="rememberMe">
                                                    <label class="custom-control-label" for="rememberMe">Remember Me</label>
                                                </div>
                                            </div>
                                            <a href="#" class="forget-pwd">Forget Password?</a>
                                        </div>
                                    </div>
                                    <div class="single-input-item">
                                        <button type="submit" class="btn">Login</button>
                                    </div>
                                </form>
                                <!-- Modal Forget Password -->
                                <div id="forgotPasswordModal" style="display:none; padding-top:50px">
                                    <div class="modal-content">
                                        <form id="forgotPasswordForm" action="javascript:void(0);">
                                            <h3>Forgot Password</h3>
                                            <div class="single-input-item">
                                                <input type="email" id="forgotPasswordEmail" placeholder="Enter your Email" required />
                                            </div>
                                            <div class="single-input-item">
                                                <button type="submit" class="btn">Send Reset Link</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Login Content End -->
    
                        <!-- Register Content Start -->
                        <div class="col-lg-6">
                            <div class="login-reg-form-wrap signup-form">
                                <h2>Signup Form</h2>
                                <form id="registerForm" action="javascript:void(0);">
                                    <div class="single-input-item">
                                        <input type="text" id="registerUsername" placeholder="Username" required />
                                    </div>
                                    <div class="single-input-item">
                                        <input type="text" id="registerFirstName" placeholder="First Name" required />
                                    </div>
                                    <div class="single-input-item">
                                        <input type="text" id="registerLastName" placeholder="Last Name" required />
                                    </div>
                                    <div class="single-input-item">
                                        <input type="email" id="registerEmail" placeholder="Enter your Email" required />
                                    </div>
                                    <div class="single-input-item">
                                        <input type="text" id="registerPhone" placeholder="Enter your Phone" required />
                                    </div>
                                    <div class="single-input-item">
                                        <input type="text" id="registerAddress" placeholder="Address" required />
                                    </div>
                                    <div class="single-input-item">
                                        <input type="password" id="registerPassword" placeholder="Enter your Password" required />
                                    </div>
                                    <div class="single-input-item">
                                        <input type="password" id="confirmPassword" placeholder="Repeat your Password" required />
                                    </div>
                                    <div class="single-input-item">
                                        <button type="submit" class="btn">Register</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <!-- Register Content End -->
                    </div>
                </div>
            </div>
        </div>
        <!-- login register wrapper end -->
    </main>
    <!-- main wrapper end -->

    <!-- Start Footer Area Wrapper -->
    <footer class="footer-wrapper">
        <!-- footer main area start -->
        <div class="footer-widget-area section-padding">
            <div class="container">
                <div class="row mtn-40">
                    <!-- footer widget item start -->
                    <div class="col-xl-5 col-lg-3 col-md-6">
                        <div class="widget-item mt-40">
                            <h5 class="widget-title">My Account</h5>
                            <div class="widget-body">
                                <ul class="location-wrap">
                                    <li><i class="ion-ios-location-outline"></i>Minh Khai Ward, Bac Tu Liem District, Hanoi City.</li>
                                    <li><i class="ion-ios-email-outline"></i>Mail: <a href="mailto:yourmail@gmail.com">yourmail@gmail.com</a></li>
                                    <li><i class="ion-ios-telephone-outline"></i>Phone: <a href="%2b0025425456554.html">+0123456789</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <!-- footer widget item end -->
                </div>
            </div>
        </div>
        <!-- footer main area end -->

    
    </footer>
    <!-- End Footer Area Wrapper -->

    <!-- Scroll to top start -->
    <div class="scroll-top not-visible">
        <i class="fa fa-angle-up"></i>
    </div>
    <!-- Scroll to Top End -->

    <!--=======================Javascript============================-->
    <!--=== All Vendor Js ===-->
    <script src="assets/js/vendor.js"></script>
    <!--=== All Plugins Js ===-->
    <script src="assets/js/plugins.js"></script>
    <!--=== Active Js ===-->
    <script src="assets/js/active.js"></script>
</body>
    

</html>


<script>
    const API_BASE_URL = "http://localhost:8080/auth"; // Cập nhật URL API cho phù hợp với cấu trúc backend

    // Xử lý form đăng nhập
    document.getElementById("loginForm").addEventListener("submit", async function (e) {
        e.preventDefault();

        // Lấy giá trị từ form
        const username = document.getElementById("loginUsername").value.trim();
        const password = document.getElementById("loginPassword").value.trim();

        if (!username || !password) {
            alert("Please enter both username and password.");
            return;
        }

        try {
            const response = await fetch(`${API_BASE_URL}/login`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ username, password }),
            });

            // Kiểm tra phản hồi từ server
            if (response.ok) {
                const result = await response.json();
                console.log("Server response:", result.result.result.token); // In ra toàn bộ phản hồi từ server
                
                // Lưu token vào LocalStorage
                localStorage.setItem("token", result.result.result.token);


                //console.log("Token:", result.result.result.userId);  
                // Lưu thông tin người dùng nếu cần
                localStorage.setItem("userId", result.result.result.userId); 

/*
                if(result.result.result.userId != 1){
                    
                alert("Login successful! Redirecting...");
                // Chuyển hướng người dùng
                window.location.href = "index-2.html";
                } else {
                    // Thông báo đăng nhập thành công
                alert("Login false! Redirecting...");
                }
               */ 
                window.location.href = "index-2.html";
                
            } else {
                // Nếu thông tin đăng nhập sai hoặc lỗi từ server
                const errorData = await response.json();
                alert(errorData.message || "Login failed. Please check your username and password.");
            }
        } catch (error) {
            console.error("Error logging in:", error);
            alert("An error occurred while logging in. Please try again later.");
        }
    });


    // Hiển thị modal quên mật khẩu khi nhấp vào liên kết
    document.querySelector(".forget-pwd").addEventListener("click", function (e) {
        e.preventDefault();
        document.getElementById("forgotPasswordModal").style.display = "block";
    });

    // Xử lý form quên mật khẩu
    document.getElementById("forgotPasswordForm").addEventListener("submit", async function (e) {
        e.preventDefault();
        const email = document.getElementById("forgotPasswordEmail").value;

        try {
            const response = await fetch(`${API_BASE_URL}/forgot-password`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ email }),
            });

            if (response.ok) {
                alert("Password reset link has been sent to your email.");
                // Đóng modal sau khi gửi thành công
                document.getElementById("forgotPasswordModal").style.display = "none";
            } else {
                alert("Failed to send reset link. Please check your email and try again.");
            }
        } catch (error) {
            console.error("Error sending password reset email:", error);
        }
    });

    // xử lý form đăng ký
    document.getElementById("registerForm").addEventListener("submit", async function (e) {
        e.preventDefault();

        const username = document.getElementById("registerUsername").value;
        const firstname = document.getElementById("registerFirstName").value;
        const lastname = document.getElementById("registerLastName").value;
        const email = document.getElementById("registerEmail").value;
        const phone = document.getElementById("registerPhone").value;
        const address = document.getElementById("registerAddress").value;
        const password = document.getElementById("registerPassword").value;
        const confirmPassword = document.getElementById("confirmPassword").value;

        if (password !== confirmPassword) {
            alert("Passwords do not match");
            return;
        }

        try {
            const response = await fetch(`http://localhost:8080/user`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ username, password, email, phone, address, firstname, lastname }),
            });

            if (response.ok) {
                const result = await response.json();
                alert("Registration successful");
            } else {
                alert("Registration failed");
            }
        } catch (error) {
            console.error("Error registering:", error);
        }
    });

</script>
